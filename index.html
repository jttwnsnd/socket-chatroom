<!DOCTYPE html>
<html ng-app="myApp">
<head>
	<title>Chatroom</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<style type='text/css'>
		h1{
			margin-top: 5%;
		}
		button{
			background-color: pink;
			border-radius: 3px;
			border: none;
			transition:  all .2s ease;
		}
		button:hover{
			box-shadow: 0px 2px 3px #333;
			transform:  translateY(-2px);
		}
		#chats{
			display:  inline-block;
			border: 1px solid black;
			height: 400px;
			border-radius: 8px;
		}
		#user-list{
			display: inline-block;
			border: 1px solid blue;
			min-height: 400px;
			border-radius: 8px;
		}
		.im{
			margin-left: 5px;
		}
		.im-name{
			font-weight:  bold;
		}
	</style>
	<script type='text/javascript' src='/socket.io/socket.io.js'></script>
	<script type='text/javascript'>
		var socketio = io.connect('http://127.0.0.1:8080');
		var name = 'Anony Mus';
		var usersLoggedIn = [];
		socketio.on('message_to_client', function(data){
			document.getElementById('chats').innerHTML += '<div class="im">' + data.message + ' -- ' + '<span class="im-name">'+ data.name + '--' + data.date + '</span></div>';
		})
		socketio.on('users', function(data){
			var newHtml = '';
			for(var i = 0; i < data.socketUsers.length; i++){
				newHtml += '<div class="col-md-12">' + data.socketUsers[i].name + '</div>';
			}
			document.getElementById('logged-in').innerHTML = newHtml;
		})

		function sendMessage(){
			var date = new Date().toLocaleString();
			var message = document.getElementById('message').value;
			socketio.emit('message_to_server', {
				message: message,
				name: name,
				date: date
			});
			socketio.emit('user_to_server', {
				name: name
			})
		}
		function sendName(){
			name = document.getElementById('nameInput').value;
			socketio.emit('user_to_server', {
				name: name
			})
		}
	</script>
</head>
<body ng-controller='myController'>
<div class="col-xs-12">
	<h1>Chat Room</h1>
</div>
	<div class="input-wrapper col-md-12">
		<div class="col-md-5">
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon1">Name</span>
				<input type="text" id="nameInput" class="form-control" placeholder="buddy42">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button" id="name-btn" onclick='sendName()'>Enter</button>
				</span>
			</div>
			<div class="input-group" id="chat-window">
				<span class="input-group-addon" id="basic-addon1">Message</span>
				<input type="text" id="message" class="form-control" placeholder="your message here">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button" onclick='sendMessage()'>...</button>
				</span>
			</div>
			</div>
	</div>
	<div class='col-md-8'>
		<div id="chats" class='col-md-8'></div>
		<div class='col-md-2' id="user-list">
			<div class="col-md-12">Users Logged In</div>
			<div class="col-md-12" id="logged-in"></div>
		</div>
	</div>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js'></script>
<script>
	var myApp = angular.module('myApp',[])
	myApp.controller('myController', function($scope){
		$scope.message = 'Test';
	})
</script>
</body>
</html>
